- content_for :header do
  %h1 Who are you visiting?

%p Please make sure you've spoken to the prisoner you're visiting before you book a visit.

= form_for visit.prisoner, url: update_step1_path, as: :prisoner, :html => { :class => 'form validation' } do |f|

  - if f.object.errors.any?
    #error-summary.validation-summary.group(role="alert" tabindex="-1" aria-labelledby="error-heading")
      %h2#error-heading Your form could not be submitted. Please fix the errors below.

  .group{ :class => ('validation-error' if f.object.errors.include?(:first_name)) }
    = f.label :first_name do
      First name of prisoner
      %span.validation-message= f.object.errors[:first_name].first if f.object.errors.include?(:first_name)
    = f.text_field :first_name

  .group{ :class => ('validation-error' if f.object.errors.include?(:last_name)) }
    = f.label :last_name do
      Last name of prisoner
      %span.validation-message= f.object.errors[:last_name].first if f.object.errors.include?(:last_name)
    = f.text_field :last_name

  .group.js-dob{ :class => ('validation-error' if f.object.errors.include?(:date_of_birth)) }
    .js-dob__input
      = f.label :date_of_birth do
        Date of birth
        %span.validation-message= f.object.errors[:date_of_birth].first if f.object.errors.include?(:date_of_birth)
      %input#prisoner_date_of_birth.js-dob__input{ value: (visit.prisoner.date_of_birth.present? ? visit.prisoner.date_of_birth : 32.years.ago.beginning_of_year ).strftime('%Y-%m-%d') }(type="date" name="prisoner[date_of_birth]")
      %p.group__help
        %small Please use the format dd/mm/yyyy
    
    .js-dob__dropdowns.hidden
      %label(for="prisoner_dob_day")
        Date of birth
        %span.validation-message= f.object.errors[:date_of_birth].first if f.object.errors.include?(:date_of_birth)
      
      %select#prisoner_dob_day.js-dob__select.js-dob__day
        %option day
        - dob_day_range.each do |day|
          %option{ value: day.strftime('%d'), selected: ('selected' if visit.prisoner.date_of_birth.present? && visit.prisoner.date_of_birth.strftime('%d') == day.strftime('%d') ) }= day.strftime('%e')
      
      %select.js-dob__select.js-dob__month
        %option month
        - dob_month_range.keys.each do |month|
          %option{ value: month.strftime('%m'), selected: ('selected' if visit.prisoner.date_of_birth.present? && visit.prisoner.date_of_birth.strftime('%m') == month.strftime('%m') ) }= month.strftime('%B')
      
      %select.js-dob__select.js-dob__year
        %option year
        - (100.years.ago.strftime('%Y').to_i..1995).each do |year|
          %option{ value: year, selected: select_year(visit.prisoner.date_of_birth, year, 32) }= year

  .group{ :class => ('validation-error' if f.object.errors.include?(:number)) }
    = f.label :number do
      Prisoner number
      %span.validation-message= f.object.errors[:number].first if f.object.errors.include?(:number)
    = f.text_field :number

  .group{ :class => ('validation-error' if f.object.errors.include?(:prison_name)) }
    = f.label :prison_name do
      Name of the prison
      %span.validation-message= f.object.errors[:prison_name] if f.object.errors.include?(:prison_name)
    = f.select :prison_name, Prisoner::PRISONS

  .actions= f.submit :Continue, :class => 'button button-primary'
