- content_for :header, (instant_booking? && !process_as_email? ? 'Check your visit booking details' : 'Check your request')

- if visit.errors.include?(:api)
  #error-summary.validation-summary.group
    %h2 Your details have not been recognised
    %p= visit.errors[:api].first

.compact
  %h2 Prisoner details
  %p
    %big
      %strong #{visit.prisoner.first_name} #{visit.prisoner.last_name}
  %p
    Date of birth:
    %strong= format_date visit.prisoner.date_of_birth
  - if visit.prisoner.number.present?
    %p
      Prisoner number:
      %strong #{visit.prisoner.number}
  %p
    Prison:
    %strong #{visit.prisoner.prison_name}
  %p.edit-link= link_to 'Change prisoner details', prisoner_details_path

.divider.compact
  %h2 Visitor details
  %p
    Confirmation email:
    %strong= visit.visitors.first.email
  - visit.visitors.each_with_index do |visitor, i|
    - if visitor.first_name.present? || visitor.last_name.present?
      %p
        Visitor #{i+1}:
        %strong #{visitor.first_name} #{visitor.last_name}
        \ -
        = format_date visitor.date_of_birth
        - if visitor.adult?
          %small.adult Adult
        - else
          %small.child Child
  %p.edit-link= link_to 'Change visitor details', visitor_details_path

.divider.compact.visit-details
  %h2= instant_booking? && !process_as_email? ? 'Chosen visit time' : 'Your visit'
  - if instant_booking? && !process_as_email?
    %strong= Date.parse(visit.slots.first.date).strftime("%A %e %B")
    \ -
    = display_slot_and_duration visit.slots.first.times
  - else

    - if visit.slots.dup.delete_if{|s|s.date.blank?}.size < 3
      %p You can choose up to 2 alternative dates if your first choice isnâ€™t available.

    %p First choice:
    %p
      %strong= format_day visit.slots.first.date
      = display_slot_and_duration visit.slots.first.times
  
    - if visit.slots[1].date.present?
      %p.alt Alternatives:
      %ol.unstyled-list
        - visit.slots[1..-1].each do |slot|
          - if slot.date.present?
            %li
              %strong= format_day slot.date
              = display_slot_and_duration slot.times

  %p.edit-link= link_to 'Change visit details', choose_date_and_time_path


.divider
  
  = link_to 'Terms & conditions', terms_and_conditions_path
  
  .actions
    .primary-actions
      - label = instant_booking? && !process_as_email? ? 'Confirm booking' : 'Send request'
      = button_to label, update_check_your_request_path, class: 'button button-primary', form: { id: 'send-request-form' }
    %p= link_to 'Cancel and delete all details', abandon_path, :'data-confirm' => "Are you sure you wish to cancel this visit request?\r\rThis will delete all the information you have entered"
