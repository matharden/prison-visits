- content_for :header, 'Your request is being processed'

.Grid
  .Grid-2-3
    %p 
      %strong Your visit is not booked yet:
      you'll get a confirmation email to 
      = mail_to visit.visitors.first.email
      within 3 working days. If you don't get a confirmation email, please
      - if prison_phone.present?
        call #{prison_phone} or
      email us at #{prison_email_link}.


.Grid
  .Grid-2-3
    %dl
      %dt Your visit options
      %dd
        %ul.unstyled-list.visit-times
          - visit.slots.each_with_index do |slot, index|
            - if slot.date.present?
              %li
                Option #{index+1}:
                - slot_date = Date.parse(slot.date)
                %strong= slot_date.strftime("%A %e %B")
                \ -
                = display_slot_and_duration slot.times


.Grid(style="margin-top:1em")
  .Grid-1-3
    %dl
      %dt Location
      %dd.h3
        %strong
          = visit.prisoner.prison_name
          %br
          = prison_address
    
    %p.map-link= link_to 'View on Google maps', "http://google.com/maps?q=#{prison_postcode}", :rel => 'external'

  .Grid-1-3
    %dl
    - if prison_phone.present?
      %dt Tel
      %dd.h3
        %strong= prison_phone
    
    - if prison_email.present?
      %br
      %dt Email
      %dd
        %strong= prison_email_link

  .Grid-1-3
    %p.visible--js-enabled= link_to 'Print this page', '#', :class => 'print-link'


.Grid#info
  .Grid-1-3
    %nav
      %h2 Visiting #{visit.prisoner.prison_name} prison
      %ul.jump-links
        %li
          %a(href='#info-check-spam') If you don't get an email to confirm your visit
        %li
          %a(href='#info-id-requirements') ID you need for each visit
        %li
          %a(href='#info-cancelling') Changing or cancelling your visit
        %li
          %a(href='#info-what-to-bring') What to bring
        %li
          %a(href='#info-what-to-expect') What to expect when visiting prison
        %li
          %a(href='#info-what-not-to-bring') What not to bring

  .Grid-2-3
    
    %h2#info-check-spam If you don't get an email to confirm your visit

    %p Follow these steps if you don't get an email to confirm your visit within 3 working days.

    %ul
      %li Check your spam / junk folder on a computer or tablet (rather than a smart phone). If the confirmation email is there, mark it as 'not spam' so that you don't have problems with future emails.
      %li
        Contact the prison
        - if prison_phone.present?
          on #{prison_phone} or 
        by email at #{prison_email_link}. Please don't contact us sooner than 3 working days, as we won't be able to comment on booking requests that are being processed.
    
    %h2#info-id-requirements
      %strong<
        %acronym(title='Identification') ID
        you need for each visit

    %p Please make sure you bring ID with you. This can be ONE of the following:

    %ul
      %li passport, including foreign passports, and expired passports where the photograph is still recognisable
      %li identity card (including European identity cards) 
      %li driving licence
      %li benefits book
      %li senior citizen's public transport photo pass issued by a local authority
      %li employer's or student ID card but only if this has a photo and clearly shows your name and the issuing employer or educational establishment

    %p If you don't have one of these forms of ID, you can bring TWO of the following:

    %ul
      %li birth or marriage certificate
      %li cheque book or credit or debit card 
      %li employer's pass or ID or student ID card without photo 
      %li young person's 'proof of age' card
      %li trade union or National Students' Union membership card
      %li rent book
      %li foreign identity or residents' card

    %p If you have any questions about ID requirements, please contact the prison.

  
    %h2#info-cancelling Changing or cancelling your visit

    %p If you need to change or cancel your visit, please contact us as soon as you can.
    %ul
      - if prison_phone.present?
        %li telephone: #{prison_phone}
      - if prison_email.present?
        %li email: #{prison_email_link}

  
    %h2#info-what-to-bring What to bring

    %ul
      %li two forms of ID, one with your address
      %li a small amount of money for tea and coffee during the visit – you won’t be able to give the prisoner any money
      %li for more information about what to bring, for example clothes, please see the #{prison_link(visit)} page

  
    %h2#info-what-to-expect What to expect when visiting prison

    %p You will be searched before entering the prison visiting room. Prison staff may check your pockets, pat you down and ask you to go through a metal detector. Dogs may also be used to detect illegal substances.

  
    %h2#info-what-not-to-bring What not to bring

    %p Please do not bring anything restricted or illegal to the prison. For more information about what you are allowed to bring, please see the #{prison_link(visit)} page.


- unless just_testing?
  - content_for :analytics do
    :ruby
      haml_io << "visitMetadata = "
      haml_io << GoogleAnalyticsAdapter.new(visit).to_json
      haml_io << ";"

      haml_io << "ga('set', {"
      haml_io << "'dimension1': visitMetadata.prison_name,"
      haml_io << "'dimension2': visitMetadata.slot_weekdays[0],"
      haml_io << "'dimension3': visitMetadata.slot_times[0],"
      haml_io << "'dimension4': visitMetadata.completed_at,"
      haml_io << "'metric1': visitMetadata.prisoner_age,"
      haml_io << "'metric2': visitMetadata.visitor_age,"
      haml_io << "'metric3': visitMetadata.number_of_slots,"
      haml_io << "'metric4': visitMetadata.number_of_adult_visitors,"
      haml_io << "'metric5': visitMetadata.number_of_child_visitors"
      haml_io << "});"

      haml_io << "if (visitMetadata.days_to_first_slot) {"
      haml_io << "ga('set', 'metric6', visitMetadata.days_to_first_slot);"
      haml_io << "}"

