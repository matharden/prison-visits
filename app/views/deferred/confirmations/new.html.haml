- content_for :header, "Visit request for #{booked_visit.prisoner.first_name} #{booked_visit.prisoner.last_name}"

.Grid
  .Grid-3-4

    = form_for @confirmation, url: confirmation_path do |f|
      = hidden_field_tag :state, params[:state]

      %h2 Visit date

      .group{ :class => ('validation-error' if f.object.errors.include?(:outcome)) }
        - booked_visit.slots.each_with_index do |slot, index|
          - if slot.date.present?
            %label.block-label{ for: "confirmation_outcome_slot_#{index}" }
              = radio_button_tag 'confirmation[outcome]', "slot_#{index}", false, { :'data-conditional-el' => "vonumber_field", :class => 'js-Conditional' }
              = succeed ':' do
                = index == 0 ? "First choice" : "Alternative #{index}"
              %strong
                = Date.parse(slot.date).strftime('%A, %d/%m/%Y from ')
                = format_time_str_24 slot.times.split('-')[0]
                \-
                = format_time_str_24 slot.times.split('-')[1]

        .panel-indent{ :id => "vonumber_field", :class => ('validation-error' if f.object.errors.include?(:number)) }
          %label{ :for => "vonumber" }
            VO number
            %span.validation-message= f.object.errors[:number].first if f.object.errors.include?(:number)
          = text_field_tag "vonumber", nil, :maxlength => 8

        %label.block-label(for='confirmation_outcome_no_slot_available' )
          = radio_button_tag 'confirmation[outcome]', Confirmation::NO_SLOT_AVAILABLE, false, { :'data-conditional-el' => 'details_no_slot_available', :class => 'js-Conditional' }
          None of the chosen times are available

        #details_no_slot_available.panel-indent
          %p Choose this option if:
          %ul.list-bullet
            %li the prisoner has restrictions on their visits
            %li the prisoner is due to be elsewhere, eg at court
            %li the visit can’t take place because another prisoner is having a visit at the same time and they are incompatible
          %h3 What we’ll tell the visitor:
          %p
            %em.email For security reasons, the visitor won’t be given any of the above information. All they will be told is that the visit can’t take place on the dates they’ve chosen.

      %h2 Entitlement (VOs)

      .group{ :class => ('validation-error' if f.object.errors.include?(:outcome)) }
        %label.block-label(for='confirmation_outcome_no_vos_left')
          = radio_button_tag 'confirmation[outcome]', Confirmation::NO_VOS_LEFT, false, { :'data-conditional-el' => 'details_no_vos_left', :class => 'js-Conditional' }
          The prisoner does not have any visiting allowance left

        #details_no_vos_left.panel-indent
          %p We can tell the visitor when the prisoner will have new visiting allowance. Pick the date when the prisoner’s allowance will be renewed
          %div [calendar]

        %div
          %label.block-label(for='confirmation_outcome_no_pvos_left')
            = radio_button_tag 'confirmation[outcome]', Confirmation::NO_PVOS_LEFT, false, { :'data-conditional-el' => 'details_no_pvos_left', :class => 'js-Conditional' }
            The prisoner does not have any weekend allowance

        #details_no_pvos_left.panel-indent
          %p We can tell the visitor that they can book a weekday visit before the PVO expires. Pick the date when the prisoner’s PVO will expire:
          %div [calendar]
          %p We can also tell them when the visiting allowance (VO) will be renewed. Pick the date when the prisoner’s VO will be renewed:
          %div [calendar]

      %h2 Details incorrect

      .group{ :class => ('validation-error' if f.object.errors.include?(:prisoner_incorrect)) }
        %label.block-label(for='confirmation_prisoner_incorrect')
          = check_box_tag 'confirmation[prisoner_incorrect]', Confirmation::PRISONER_INCORRECT, false, { :'data-conditional-el' => 'prisoner_incorrect', :class => 'js-Conditional' }
          Prisoner details are incorrect

      #prisoner_incorrect.panel-indent
        %h3 What we’ll tell the visitor:
        %p
          %em.email You haven’t given correct information for the prisoner, for example the prisoner’s name, number or date of birth is incorrect. Please contact the prisoner to get the correct prisoner information.

      .group{ :class => ('validation-error' if f.object.errors.include?(:visitor_incorrect)) }
        %label.block-label(for='confirmation_visitor_incorrect')
          = check_box_tag 'confirmation[visitor_incorrect]', 1, false, { :'data-conditional-el' => 'visitors_not_found', :class => 'js-Conditional' }
          Visitor details incorrect

      #visitors_not_found.panel-indent
        %h3 What we’ll tell the visitor:
        %p
          %em.email The details you’ve provided don’t match what we have on our records. Please contact the prisoner and ask them to update their contact list with your details, making sure that names appear exactly the same as on your ID documents.

        - booked_visit.visitors.each_with_index do |visitor, index|
          %label.block-label{ :for => "confirmation_visitor_not_found_#{index}" }
            = check_box_tag 'confirmation[visitor_not_found]', index
            #{visitor.first_name} #{visitor.last_name} #{visitor.date_of_birth.strftime("%d/%m/%Y")} details are incorrect

      .group{ :class => ('validation-error' if f.object.errors.include?(:visitor_banned)) }
        %label.block-label(for='confirmation_visitor_banned')
          = check_box_tag 'confirmation[visitor_banned]', Confirmation::VISITOR_BANNED, false, { :'data-conditional-el' => 'visitors_banned', :class => 'js-Conditional' }
          Visitor is banned

      #visitors_banned.panel-indent
        %h3 What we’ll tell the visitor:
        %p
          %em.email You should have received a letter to say that you’re banned from visiting the prison at the moment. Get in touch with the prison for more information.

        - booked_visit.visitors.each_with_index do |visitor, index|
          %label.block-label{ :for => "confirmation_visitor_banned_#{index}" }
            = check_box_tag 'confirmation[visitor_banned]', index
            #{visitor.first_name} #{visitor.last_name} #{visitor.date_of_birth.strftime("%d/%m/%Y")} is banned

      = f.button 'Send confirmation email', :class => 'button button-primary js-submit'
